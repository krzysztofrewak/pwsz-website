server {
	listen 80;
	server_name pwsz.dev *.pwsz.dev;
	root "C:/laragon/www/pwsz/public/";
	
	index index.html index.htm index.php;
 
	location / {
		try_files $uri $uri/ /index.html$is_args$args;
	}

	location /api/ {
		try_files $uri $uri/ /index.php$is_args$args;
	}
	
	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
		fastcgi_pass php_upstream;		
		#fastcgi_pass unix:/run/php/php7.0-fpm.sock;
		
		set $cors '';
		if ($http_origin ~ '^https?://(localhost)') {
				set $cors 'true';
		}

		if ($cors = 'true') {
				add_header 'Access-Control-Allow-Origin' "$http_origin" always;
				add_header 'Access-Control-Allow-Credentials' 'true' always;
				add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
				add_header 'Access-Control-Allow-Headers' 'Accept,Authorization,Cache-Control,Content-Type,DNT,If-Modified-Since,Keep-Alive,Origin,User-Agent,X-Requested-With' always;
				# required to be able to read Authorization header in frontend
				#add_header 'Access-Control-Expose-Headers' 'Authorization' always;
		}

		if ($request_method = 'OPTIONS') {
				# Tell client that this pre-flight info is valid for 20 days
				add_header 'Access-Control-Max-Age' 1728000;
				add_header 'Content-Type' 'text/plain charset=UTF-8';
				add_header 'Content-Length' 0;
				return 204;
		}
	}
	
	
	charset utf-8;
	
	location = /favicon.ico { access_log off; log_not_found off; }
	location = /robots.txt  { access_log off; log_not_found off; }
	location ~ /\.ht {
		deny all;
	}
}
